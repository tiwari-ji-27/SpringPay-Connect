# üí≥ Spring Boot Payment Gateway with Razorpay and Email Service

This project implements a secure and scalable Payment Gateway using Spring Boot. It integrates with **Razorpay** for payment processing and uses **Spring Mail** to send automated enrollment confirmation emails upon successful payment. It uses **MySQL** as the persistence layer.

## üöÄ Technology Stack

The application is built using the following core technologies:

| Technology | Detail | Source |
| :--- | :--- | :--- |
| **Backend** | Spring Boot 3.5.7 (Maven) | |
| **Language** | Java 21 | |
| **Payment Processor** | Razorpay (using `com.razorpay:razorpay-java:1.4.8`) | |
| **Database** | MySQL (using `mysql-connector-j`) | |
| **ORM** | Spring Data JPA (Hibernate) | |
| **Email Service** | Spring Boot Starter Mail (for SMTP) | |
| **CORS** | Global CORS configured for `/api/**` | |

## ‚ú® Features and Endpoints

The Payment Controller exposes the following RESTful endpoints under the base path `/api/payment`:

### 1. Create Order (Initiate Payment)

This endpoint is called by the client application to create an order in your system and generate a corresponding order on the Razorpay platform.

* **URL:** `/api/payment/create-order`
* **Method:** `POST`
* **Request Body (`PaymentOrder` Entity):** Requires details like `amount`, `email`, and `courseName`.
* **Response:** Returns the JSON response from the Razorpay API, including the generated `orderId`.
* **Logic:** Saves the order to the database with `status="CREATED"`.

### 2. Update Order Status (Callback)

This endpoint is called by the client application after the payment is successfully processed (or failed) on the Razorpay popup/checkout form.

* **URL:** `/api/payment/update-order`
* **Method:** `POST`
* **Request Parameters (`@RequestParam`):**
    * `paymentId` (The unique ID of the payment transaction)
    * `orderId` (The unique ID of the order generated by Razorpay)
    * `status` (The final transaction status, typically "SUCCESS" or "FAILED").
* **Response:** `Order updated successfully.`
* **Logic:** Updates the `paymentId` and `status` in the database. If the `status` is **"SUCCESS"** (case-insensitive), it triggers an enrollment confirmation email using `EmailService`.

## üõ†Ô∏è Configuration

All configuration is managed in `src/main/resources/application.properties`.

### 1. Razorpay Configuration

Replace these placeholders with your actual Razorpay Test or Production keys.

```properties
razorpay.key_id=rzp_test_ReFYSMTcPxXov3
razorpay.key_secret=xxamroe1VR0IlVqAQeKdoExe
````

### 2\. Email Service Configuration

The email service uses a Gmail SMTP server. **You must use a Google App Password** if you have 2-Factor Authentication enabled on your Gmail account (which is highly recommended).

```properties
spring.mail.host=smtp.gmail.com
spring.mail.port=587
# IMPORTANT: Replace with your actual sender email address
spring.mail.username=divanshutiwari836@gmail.com
# IMPORTANT: Replace with your App Password
spring.mail.password=zqll arvz clnv pycy
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.starttls.required=true
```

> **Note:** The sender email is also hardcoded in `EmailService.java` as `"YOUR_SENDER_EMAIL@gmail.com"`, which should match `spring.mail.username`.

### 3\. Database Configuration (MySQL)

Ensure you have a MySQL server running and the database schema is created.

```properties
spring.datasource.url=jdbc:mysql://localhost:3306/pay
spring.datasource.username=root
spring.datasource.password=root
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.jpa.hibernate.ddl-auto=update
# ... JPA Dialect and SQL logging properties
```

The `spring.jpa.hibernate.ddl-auto=update` property will automatically create or update the `payment_order` table based on the `PaymentOrder` JPA entity when the application starts.

## ‚ñ∂Ô∏è How to Run the Application

### Prerequisites

  * Java Development Kit (JDK) 21
  * Apache Maven
  * MySQL Server

### Steps

1.  **Clone the Repository** (Assume this project is the root of the repository).

2.  **Configure `application.properties`**: Update the Razorpay, Database, and Email credentials in `payment_gateway/src/main/resources/application.properties`.

3.  **Run the application** using the Spring Boot Maven Plugin:

    ```bash
    cd payment_gateway
    ./mvnw spring-boot:run
    # For Windows
    # .\mvnw.cmd spring-boot:run 
    ```

    The application will start on port `8080` (default for Spring Boot Web applications).

<!-- end list -->

```
```
